<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link href="projects.css" rel="stylesheet">
        <script src="../error.ts"></script>
        <script src="../api.mts" type="module"></script>
    </head>
    <body>
        <div id="error_list"></div>
        <a id="return">Return</a>
        <h3 id="title">Project</h3>
        <input id="replacement" type="text">
        <select name="status" id="status">
            <option value="1" selected>Requested</option>
            <option value="2">Prepped</option>
            <option value="3">Dispatched</option>
            <option value="5">Returned & Stored</option>
        </select>
        <script type="module">
            import {authenticate, get_projects} from "../api.mts";
            import {handle_swap} from "./swap.mts";
            const title = document.getElementById('title');
            const env = import.meta.env;
            const url = new URL(window.location.href);
            const project_id = url.searchParams.get("p");

            document.getElementById('return').href = `/project/?p=${project_id}`;
            (async function () {
                await authenticate({formInput: env.VITE_USR, password: env.VITE_PASS});
                await get_projects()
                    .then((result) => {
                        const proj = result.find(
                            (project) => project.projects_id.toString() == project_id
                        ) || {projects_name: "Unknown Project"};
                        title.innerText = proj.projects_name;
                    });
                const replacement = document.getElementById('replacement');
                const status = document.getElementById('status')
                await handle_swap(project_id, replacement, status);
            })();
        </script>
    </body>
</html>